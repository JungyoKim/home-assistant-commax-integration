# Commax Home Assistant í†µí•©êµ¬ì„±ìš”ì†Œ

ì´ í”„ë¡œì íŠ¸ëŠ” Home Assistantìš© Commax ì‹œìŠ¤í…œ í†µí•©êµ¬ì„±ìš”ì†Œì…ë‹ˆë‹¤.

## ğŸ  ì§€ì› ê¸°ëŠ¥

### ğŸ’¡ ì¡°ëª… (Light)
- **5ê°œ ì¡°ëª… ì œì–´**: ê±°ì‹¤ ì¡°ëª…1, ê±°ì‹¤ ì¡°ëª…2, ê±°ì‹¤ ì¡°ëª…3, ê±°ì‹¤ ì¡°ëª…4, ë³µë„ ì¡°ëª…
- **ê°œë³„ ON/OFF ì œì–´**: ê° ì¡°ëª…ì„ ë…ë¦½ì ìœ¼ë¡œ ì œì–´
- **ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§**: ì¡°ëª… ìƒíƒœ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

### ğŸ”¥ ë³´ì¼ëŸ¬ (Climate)
- **4ê°œ ë°© ë³´ì¼ëŸ¬ ì œì–´**: ê±°ì‹¤, ì•ˆë°©, ê³µë¶€ë°©, ì¹¨ëŒ€ë°© ë³´ì¼ëŸ¬
- **ì˜¨ë„ ì„¤ì •**: ëª©í‘œ ì˜¨ë„ ì„¤ì • (5-53Â°C)
- **ON/OFF ì œì–´**: ë³´ì¼ëŸ¬ ì¼œê¸°/ë„ê¸°
- **ëª¨ë“œ ë³€ê²½**: ë‚œë°© ëª¨ë“œ ì „í™˜
- **ì‹¤ì‹œê°„ ìƒíƒœ**: í˜„ì¬ ì˜¨ë„ ë° ë™ì‘ ìƒíƒœ ëª¨ë‹ˆí„°ë§

### ğŸšª ë„ì–´ (Switch)
- **ì ê¸ˆ/í•´ì œ**: í˜„ê´€ë¬¸ ì ê¸ˆ ë° í•´ì œ
- **ìƒíƒœ ëª¨ë‹ˆí„°ë§**: ë„ì–´ ì ê¸ˆ ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸

### ğŸ”” ë„ì–´ë²¨ (Binary Sensor)
- **ë„ì–´ë²¨ ì•Œë¦¼**: ë„ì–´ë²¨ ìš¸ë¦¼ ê°ì§€
- **ìë™ ë¦¬ì…‹**: 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ìƒíƒœ ë¦¬ì…‹

### ğŸ›— ì—˜ë¦¬ë² ì´í„° (Switch)
- **ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ**: ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ ë²„íŠ¼
- **ì¸µ ì„ íƒ**: íŠ¹ì • ì¸µ í˜¸ì¶œ (1-9ì¸µ)
- **ìƒíƒœ ëª¨ë‹ˆí„°ë§**: ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ ìƒíƒœ í™•ì¸

### âš¡ ì¼ê´„ì†Œë“± (Switch)
- **ì „ì²´ ON/OFF**: ëª¨ë“  ì¡°ëª…ì„ í•œ ë²ˆì— ì¼œê¸°/ë„ê¸°
- **ìƒíƒœ ëª¨ë‹ˆí„°ë§**: ì¼ê´„ì†Œë“± ìƒíƒœ í™•ì¸

## ğŸ”§ í•˜ë“œì›¨ì–´ ìš”êµ¬ì‚¬í•­

- **USB to RS485 ì–´ëŒ‘í„°**: FTDI, Prolific, CH340 ë“± ì§€ì›
- **Commax ì‹œìŠ¤í…œ**: RS485 í†µì‹  ì§€ì›
- **ì‹œë¦¬ì–¼ í¬íŠ¸**: 9600 baud, 8N1 ì„¤ì •

## ğŸ“‹ í†µì‹  í”„ë¡œí† ì½œ

### íŒ¨í‚· êµ¬ì¡°
- **ì¡°ëª…**: `3001000000000031` ~ `3005000000000035` (ìƒíƒœ ì¡°íšŒ)
- **ë³´ì¼ëŸ¬**: `4001000000000041` (ìƒíƒœ ì¡°íšŒ)
- **ë„ì–´**: `5001000000000051` (ìƒíƒœ ì¡°íšŒ)
- **ë„ì–´ë²¨**: `6001000000000061` (ìƒíƒœ ì¡°íšŒ)
- **ì—˜ë¦¬ë² ì´í„°**: `7001000000000071` (ìƒíƒœ ì¡°íšŒ)
- **ì¼ê´„ì†Œë“±**: `8001000000000081` (ìƒíƒœ ì¡°íšŒ)

## ğŸš€ ì„¤ì¹˜ ë° ì„¤ì •

### 1. íŒŒì¼ ë³µì‚¬
Home Assistantì˜ `config/custom_components/` ë””ë ‰í† ë¦¬ì— `commax` í´ë”ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.

### 2. Home Assistant ì¬ì‹œì‘
ì„¤ì • > ì‹œìŠ¤í…œ > ì¬ì‹œì‘ì—ì„œ Home Assistantë¥¼ ì¬ì‹œì‘í•©ë‹ˆë‹¤.

### 3. í†µí•©êµ¬ì„±ìš”ì†Œ ì¶”ê°€
ì„¤ì • > í†µí•©êµ¬ì„±ìš”ì†Œ > í†µí•©êµ¬ì„±ìš”ì†Œ ì¶”ê°€ì—ì„œ "Commax"ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€í•©ë‹ˆë‹¤.

### 4. ì‹œë¦¬ì–¼ í¬íŠ¸ ì„¤ì •
ê¸°ì¡´ Go ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ë˜ í¬íŠ¸ ì„¤ì •ì„ ì°¸ê³ í•˜ì—¬ ì„¤ì •í•©ë‹ˆë‹¤:

| ê¸°ê¸° | USB í¬íŠ¸ | ì„¤ëª… |
|------|----------|------|
| ì¡°ëª… | `/dev/ttyUSB3` | 5ê°œ ì¡°ëª… ì œì–´ |
| ë³´ì¼ëŸ¬ | `/dev/ttyUSB2` | 4ê°œ ë°© ë³´ì¼ëŸ¬ ì œì–´ |
| ì—˜ë¦¬ë² ì´í„° | `/dev/ttyUSB0` | ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ |
| ë„ì–´ë²¨ | `/dev/ttyUSB1` | ë„ì–´ë²¨ ê°ì§€ ë° ë¬¸ì—´ê¸° |

**Windows í™˜ê²½ì—ì„œëŠ”:**
- `COM1`, `COM2`, `COM3`, `COM4` ë“±ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
- ì¥ì¹˜ ê´€ë¦¬ìì—ì„œ USB to RS485 ì–´ëŒ‘í„°ì˜ COM í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### 5. ì„¤ì • ì™„ë£Œ
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì„ íƒ
- í†µì‹  ì†ë„: 9600 bps (ê¸°ë³¸ê°’)
- íƒ€ì„ì•„ì›ƒ: 0.1ì´ˆ (ê¸°ë³¸ê°’)
- ìŠ¤ìº” ê°„ê²©: 1ì´ˆ (ê¸°ë³¸ê°’)

ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ì—”í‹°í‹°ë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤:

## ğŸ§ª í…ŒìŠ¤íŠ¸

### 1. í•˜ë“œì›¨ì–´ ì—°ê²° í™•ì¸
ê¸°ì¡´ Go ì½”ë“œê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸í•˜ì„¸ìš”:
```bash
# ê¸°ì¡´ Go í”„ë¡œê·¸ë¨ ì‹¤í–‰
go run main.go
```

### 2. Home Assistant í†µí•©êµ¬ì„±ìš”ì†Œ í…ŒìŠ¤íŠ¸
1. **ì¡°ëª… í…ŒìŠ¤íŠ¸**
   - Home Assistant UIì—ì„œ ì¡°ëª… ì—”í‹°í‹° ON/OFF
   - ì‹¤ì œ ì¡°ëª…ì´ ì¼œì§€ê³  êº¼ì§€ëŠ”ì§€ í™•ì¸

2. **ë³´ì¼ëŸ¬ í…ŒìŠ¤íŠ¸**
   - Home Assistant UIì—ì„œ ë³´ì¼ëŸ¬ ì—”í‹°í‹° ëª¨ë“œ ë³€ê²½
   - ì˜¨ë„ ì„¤ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   - ì‹¤ì œ ë³´ì¼ëŸ¬ê°€ ë°˜ì‘í•˜ëŠ”ì§€ í™•ì¸

3. **ë„ì–´ë²¨ í…ŒìŠ¤íŠ¸**
   - ì‹¤ì œ ë„ì–´ë²¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ Home Assistantì—ì„œ ì´ë²¤íŠ¸ ê°ì§€ í™•ì¸
   - Home Assistantì—ì„œ ë¬¸ì—´ê¸° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

4. **ì—˜ë¦¬ë² ì´í„° í…ŒìŠ¤íŠ¸**
   - Home Assistant UIì—ì„œ ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ ë²„íŠ¼ í…ŒìŠ¤íŠ¸
   - ì‹¤ì œ ì—˜ë¦¬ë² ì´í„°ê°€ í˜¸ì¶œë˜ëŠ”ì§€ í™•ì¸

5. **ì¼ê´„ì†Œë“± í…ŒìŠ¤íŠ¸**
   - Home Assistant UIì—ì„œ ì¼ê´„ì†Œë“± ON/OFF í…ŒìŠ¤íŠ¸
   - ëª¨ë“  ì¡°ëª…ì´ ë™ì‹œì— ì¼œì§€ê³  êº¼ì§€ëŠ”ì§€ í™•ì¸

### 3. ë¡œê·¸ í™•ì¸
Home Assistant ê°œë°œì ë„êµ¬ > ë¡œê·¸ì—ì„œ ë‹¤ìŒì„ í™•ì¸:
- ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì„±ê³µ/ì‹¤íŒ¨
- íŒ¨í‚· ì „ì†¡/ìˆ˜ì‹  ë¡œê·¸
- ì—”í‹°í‹° ìƒíƒœ ë³€ê²½ ë¡œê·¸

### 4. ë¬¸ì œ í•´ê²°
- **ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì‹¤íŒ¨**: í¬íŠ¸ ë²ˆí˜¸ í™•ì¸, ê¶Œí•œ í™•ì¸
- **íŒ¨í‚· ì „ì†¡ ì‹¤íŒ¨**: USB to RS485 ì–´ëŒ‘í„° ë“œë¼ì´ë²„ í™•ì¸
- **ì—”í‹°í‹° ì‘ë‹µ ì—†ìŒ**: RS485 ì¼€ì´ë¸” ì—°ê²° ìƒíƒœ í™•ì¸

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
custom_integration/
â”œâ”€â”€ __init__.py          # ë©”ì¸ ì´ˆê¸°í™”
â”œâ”€â”€ manifest.json        # í†µí•©êµ¬ì„±ìš”ì†Œ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ const.py            # ìƒìˆ˜ ì •ì˜
â”œâ”€â”€ config_flow.py      # ì„¤ì • í”Œë¡œìš°
â”œâ”€â”€ light.py            # ì¡°ëª… í”Œë«í¼
â”œâ”€â”€ climate.py          # ë³´ì¼ëŸ¬ í”Œë«í¼
â”œâ”€â”€ switch.py           # ë„ì–´/ì—˜ë¦¬ë² ì´í„°/ì¼ê´„ì†Œë“± í”Œë«í¼
â”œâ”€â”€ binary_sensor.py    # ë„ì–´ë²¨ í”Œë«í¼
â””â”€â”€ translations/       # ë²ˆì—­ íŒŒì¼
    â””â”€â”€ ko.json
```

## ğŸ”„ ê¸°ì¡´ MQTTì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜

ê¸°ì¡´ Go MQTT ì½”ë“œì—ì„œ Home Assistant í†µí•©êµ¬ì„±ìš”ì†Œë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜:

### MQTT í† í”½ ë§¤í•‘
- **ê¸°ì¡´**: `commax/lights/1/set` â†’ **ìƒˆë¡œìš´**: Home Assistant ì¡°ëª… ì—”í‹°í‹°
- **ê¸°ì¡´**: `commax/lights/1/state` â†’ **ìƒˆë¡œìš´**: ìë™ ìƒíƒœ ì—…ë°ì´íŠ¸

### ì¥ì 
- âœ… Home Assistant ë„¤ì´í‹°ë¸Œ ì§€ì›
- âœ… ìë™í™” ë° ìŠ¤í¬ë¦½íŠ¸ í†µí•©
- âœ… ì‚¬ìš©ì ì¹œí™”ì  UI
- âœ… ì„¤ì • ê´€ë¦¬ ê°„ì†Œí™”
- âœ… ëª¨ë“  Commax ê¸°ê¸° í†µí•© ê´€ë¦¬

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### ìë™í™” ì˜ˆì‹œ
```yaml
# ë„ì–´ë²¨ì´ ìš¸ë¦¬ë©´ ëª¨ë“  ì¡°ëª… ì¼œê¸°
automation:
  - alias: "ë„ì–´ë²¨ ì•Œë¦¼ ì‹œ ì¡°ëª… ì¼œê¸°"
    trigger:
      platform: state
      entity_id: binary_sensor.commax_doorbell_0
      to: "on"
    action:
      - service: light.turn_on
        target:
          entity_id: light.commax_light_0, light.commax_light_1

# ì™¸ì¶œ ì‹œ ëª¨ë“  ì¡°ëª… ë„ê¸°
automation:
  - alias: "ì™¸ì¶œ ì‹œ ì¼ê´„ì†Œë“±"
    trigger:
      platform: state
      entity_id: switch.commax_door_0
      to: "off"
    action:
      - service: switch.turn_off
        target:
          entity_id: switch.commax_master_0
```

## ğŸ¤– ìë™í™” ì˜ˆì‹œ

### 1. ë„ì–´ë²¨ ìë™í™”
```yaml
# ë„ì–´ë²¨ì´ ìš¸ë¦¬ë©´ ì•Œë¦¼ ë³´ë‚´ê¸°
automation:
  - alias: "ë„ì–´ë²¨ ì•Œë¦¼"
    trigger:
      platform: state
      entity_id: binary_sensor.commax_doorbell
      to: "on"
    action:
      - service: notify.mobile_app
        data:
          title: "ë„ì–´ë²¨"
          message: "ëˆ„êµ°ê°€ ë„ì–´ë²¨ì„ ëˆŒë €ìŠµë‹ˆë‹¤!"
```

### 2. ì™¸ì¶œ ì‹œ ì¼ê´„ì†Œë“±
```yaml
# ì™¸ì¶œ ëª¨ë“œ í™œì„±í™” ì‹œ ëª¨ë“  ì¡°ëª… ë„ê¸°
automation:
  - alias: "ì™¸ì¶œ ì‹œ ì¼ê´„ì†Œë“±"
    trigger:
      platform: state
      entity_id: input_boolean.away_mode
      to: "on"
    action:
      - service: switch.turn_off
        target:
          entity_id: switch.commax_master
```

### 3. ë³´ì¼ëŸ¬ ìë™ ì œì–´
```yaml
# ì˜¨ë„ì— ë”°ë¥¸ ë³´ì¼ëŸ¬ ìë™ ì œì–´
automation:
  - alias: "ë³´ì¼ëŸ¬ ìë™ ì œì–´"
    trigger:
      platform: numeric_state
      entity_id: sensor.living_room_temperature
      below: 18
    action:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.commax_boiler_1
        data:
          hvac_mode: heat
```

### 4. ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ ìë™í™”
```yaml
# íŠ¹ì • ì‹œê°„ì— ì—˜ë¦¬ë² ì´í„° ìë™ í˜¸ì¶œ
automation:
  - alias: "ì•„ì¹¨ ì—˜ë¦¬ë² ì´í„° í˜¸ì¶œ"
    trigger:
      platform: time
      at: "07:00:00"
    action:
      - service: switch.turn_on
        target:
          entity_id: switch.commax_elevator
```

## ğŸ› ë¬¸ì œ í•´ê²°

### ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì‹¤íŒ¨
1. USB to RS485 ì–´ëŒ‘í„° ë“œë¼ì´ë²„ í™•ì¸
2. í¬íŠ¸ ê¶Œí•œ í™•ì¸ (Linux: `sudo usermod -a -G dialout $USER`)
3. ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì—ì„œ í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸

### ê¸°ê¸° ì œì–´ ì•ˆë¨
1. RS485 í†µì‹  ìƒíƒœ í™•ì¸
2. íŒ¨í‚· í˜•ì‹ í™•ì¸
3. ê¸°ê¸° ì‹œìŠ¤í…œ ì „ì› ìƒíƒœ í™•ì¸

## ğŸ“ ë¼ì´ì„¼ìŠ¤

MIT License

## ğŸ¤ ê¸°ì—¬

ë²„ê·¸ ë¦¬í¬íŠ¸ ë° ê¸°ëŠ¥ ìš”ì²­ì€ GitHub Issuesë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”. 